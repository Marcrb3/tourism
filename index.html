<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>Turisme a l'AMB</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css' rel='stylesheet' />
  <script
    src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.min.js'></script>
  <link rel='stylesheet'
    href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.css'
    type='text/css' />
  <!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>


  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    .menu-ui {
      background: rgb(248, 243, 225);
      position: absolute;
      top: 50px;
      left: 10px;
      z-index: 1;
      border-radius: 3px;
      width: 150px;
      border: 1px solid rgba(0, 0, 0, 0.4);
    }

    .menu-ui a {
      font-size: 12px;
      font-family: verdana;
      color: #404040;
      display: block;
      margin: 0;
      padding: 0;
      padding: 10px;
      text-decoration: none;
      border-bottom: 1px solid rgba(0, 0, 0, 0.25);
      text-align: center;
    }

    .menu-ui a:first-child {
      border-radius: 3px 3px 0 0;
    }

    .menu-ui a:last-child {
      border: none;
      border-radius: 0 0 3px 3px;
    }

    .menu-ui a:hover {
      background: #f8f8f8;
      color: #404040;
    }

    .menu-ui a.active,
    .menu-ui a.active:hover {
      background: rgb(190, 56, 56);
      color: #FFF;
    }

    .link {
      color: black;
      text-decoration: none;
      font-weight: bolder;
      font-size: 14px;
    }

    .info {
      background-color: rgba(248, 243, 225, 0.671);
      ;
      padding: 8px;
      margin-top: 5px;
      border: solid 1.5px rgb(97, 20, 20);
    }

    .infoimg {
      width: 16px;
    }
  </style>
</head>

<body>
  <nav id='menu-ui' class='menu-ui'>
    <a href='#' class='active' id='filter-all'>Tots els indrets</a>
    <a href='#' id='filter-natura'>Indrets Naturals</a>
    <a href='#' id='filter-patrimoni'>Indrets Patrimonials</a>
    <a href='#' id='filter-info'>Informació</a>
  </nav>
  <div id='map'></div>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFyY3JiMyIsImEiOiJjanJqanZvMXowYzdnNDRsbGN4N3JyMGhuIn0.im2TOkqyqEpCXhN4LWoZuA'; //  your access token
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/marcrb3/ck2a6fyu10ht71clfcj1xidnb', //  your style URL
      center: [2.16859, 41.3954],
      zoom: 10.5,
      pitch: 20,
      attributionControl: false
    });

    //afegim el control de navegació i el cercador

    map.addControl(new mapboxgl.AttributionControl({ compact: true }));
    map.addControl(new mapboxgl.NavigationControl());
    map.addControl(new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      placeholder: "Cerca...",
      mapboxgl: mapboxgl

    }), 'top-left');

    // afegim pop-ups que ens mostrin nom del lloc, la categoria i l'enllaç a la web amb més informació(de moment)

    map.on('click', function (e) {
      var features = map.queryRenderedFeatures(e.point, {
        layers: ['turisme']
      });

      if (!features.length) {
        return;
      }

      var feature = features[0];

      var popup = new mapboxgl.Popup({ offset: [0, -15] })
        .setLngLat(feature.geometry.coordinates)
        .setHTML(
          '<div class="info">' +
          '<h3>' + feature.properties.NOM + '</h3><p>'
          + '<strong>' + "Tipus:" + ' ' + '</strong>' + feature.properties.Tipus
          + '</p><p>' + '<strong>' + "Categoria:" + ' ' + '</strong>' + feature.properties.Categoria + '</p><p>'
          + '<img class="infoimg" src="goto.png"/><a class="link" target="_blank" href=' + feature.properties.URL + '> Més informació' + '</p>'
          + '</div>'

        )
        .addTo(map);
    });
    
    // Original ES6 Class— https://github.com/tobinbradley/mapbox-gl-pitch-toggle-control
// export default class PitchToggle {
class PitchToggle {
  constructor({ bearing = -20, pitch = 70, minpitchzoom = null }) {
    this._bearing = bearing;
    this._pitch = pitch;
    this._minpitchzoom = minpitchzoom;
  }

  onAdd(map) {
    this._map = map;
    let _this = this;

    this._btn = document.createElement("button");
    this._btn.className = "mapboxgl-ctrl-icon mapboxgl-ctrl-pitchtoggle-3d";
    this._btn.type = "button";
    this._btn["aria-label"] = "Toggle Pitch";
    this._btn.onclick = function() {
      if (map.getPitch() === 0) {
        let options = { pitch: _this._pitch, bearing: _this._bearing };
        if (_this._minpitchzoom && map.getZoom() > _this._minpitchzoom) {
          options.zoom = _this._minpitchzoom;
        }
        map.easeTo(options);
        _this._btn.className =
          "mapboxgl-ctrl-icon mapboxgl-ctrl-pitchtoggle-2d";
      } else {
        map.easeTo({ pitch: 0, bearing: 0 });
        _this._btn.className =
          "mapboxgl-ctrl-icon mapboxgl-ctrl-pitchtoggle-3d";
      }
    };

    this._container = document.createElement("div");
    this._container.className = "mapboxgl-ctrl-group mapboxgl-ctrl";
    this._container.appendChild(this._btn);

    return this._container;
  }

  onRemove() {
    this._container.parentNode.removeChild(this._container);
    this._map = undefined;
  }
}
map.addControl(new PitchToggle({ minpitchzoom: 11 }), "top-left");
    
    // Centrem i fem zoom a les coordenades del punt seleccionat.

    map.on('click', 'turisme', function (e) {
      map.zoomTo(14, { center: e.features[0].geometry.coordinates });

    });


    // Canviem el cursor a un punter quan passem per sobre un seleccionable.

    map.on('mouseenter', 'turisme', function () {
      map.getCanvas().style.cursor = 'pointer';
    });

    // Retorn a la mà al desseleccionar.
    map.on('mouseleave', 'turisme', function () {
      map.getCanvas().style.cursor = '';
    });




  </script>
</body>

</html>
