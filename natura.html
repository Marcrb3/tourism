<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>Turisme a l'AMB</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css' rel='stylesheet' />
  <script
    src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.min.js'></script>
  <link rel='stylesheet'
    href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.css'
    type='text/css' />
  <!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy"
    	crossorigin="anonymous">
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4"
    	crossorigin="anonymous"></script>


      <style>
        body {
          margin: 0;
          padding: 0;
        }
    
        h3 {
          font-size: 18px;
          text-align: center;
          font-weight: bolder;
          padding: 5px;
        }
    
        .mapboxgl-ctrl-pitchtoggle-3d {
          background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCI+ICAgIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkeT0iLjM1ZW0iIHN0eWxlPSJmb250LXNpemU6IDE0cHg7IGZvbnQtZmFtaWx5OiAnSGVsdmV0aWNhIE5ldWUnLEFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmOyBmb250LXdlaWdodDogYm9sZDsgdGV4dC1hbmNob3I6IG1pZGRsZTsiPjNEPC90ZXh0Pjwvc3ZnPg==);
          top: 50px;
        }
    
        .mapboxgl-ctrl-pitchtoggle-2d {
          background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCI+ICAgIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkeT0iLjM1ZW0iIHN0eWxlPSJmb250LXNpemU6IDE0cHg7IGZvbnQtZmFtaWx5OiAnSGVsdmV0aWNhIE5ldWUnLEFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmOyBmb250LXdlaWdodDogYm9sZDsgdGV4dC1hbmNob3I6IG1pZGRsZTsiPjJEPC90ZXh0Pjwvc3ZnPg==);
          top: 50px;
        }
    
        #map {
          position: absolute;
          top: 50px;
          bottom: 0;
          width: 100%;
        }
    
        .link {
          color: black;
          text-decoration: none;
          font-weight: bolder;
          font-size: 14px;
        }
    
        .infowdw {
          background-color: rgba(248, 243, 225, 0.671);
          padding: 10px;
          margin-top: 15px;
          border: solid 1.5px rgb(97, 20, 20);
        }
    
        .infoimg {
          width: 18px;
        }
      </style>
</head>

 <body onload="init()">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
  		<a class="navbar-brand" href="#">Turisme (en desenvolupament)</a>
  		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
   		 <span class="navbar-toggler-icon"></span>
  		</button>
  		<div class="collapse navbar-collapse" id="navbarNav">
    		<ul class="navbar-nav">
      		<li class="nav-item">
       		 <a class="nav-link" href="index.html">Tots els indrets</a>
     		 </li>
      		<li class="nav-item">
      		  <a class="nav-link" href="patri.html">Patrimoni</a>
     		 </li>
     		 <li class="nav-item active">
       		 <a class="nav-link" href="natura.html">Natura<span class="sr-only">(current)</span></a>
     		 </li>
		<li class="nav-item">
       		 <a class="nav-link" href="infomap.html">Informació</a>
     		 </li>
    		</ul>
  		</div>
	</nav>

  <div id='map'></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFyY3JiMyIsImEiOiJjanJqanZvMXowYzdnNDRsbGN4N3JyMGhuIn0.im2TOkqyqEpCXhN4LWoZuA'; //  your access token
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/marcrb3/cjst8y4l6fpo01fporoqv29gp', //  your style URL
      center: [2.16859, 41.3954],
      zoom: 10,
      attributionControl: false
    });
    //afegim el control de navegació i el cercador
    map.addControl(new mapboxgl.AttributionControl({ compact: true }));
    map.addControl(new mapboxgl.NavigationControl());
    map.addControl(new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      placeholder: "Cerca...",
      mapboxgl: mapboxgl
    }), 'top-left');
    // Afegim botó amb opció de visualització 2D/3D 
    class PitchToggle {
      constructor({ bearing = -20, pitch = 50, minpitchzoom = null }) {
        this._bearing = bearing;
        this._pitch = pitch;
        this._minpitchzoom = minpitchzoom;
      }
      onAdd(map) {
        this._map = map;
        let _this = this;
        this._btn = document.createElement("button");
        this._btn.className = "mapboxgl-ctrl-icon mapboxgl-ctrl-pitchtoggle-3d";
        this._btn.type = "button";
        this._btn["aria-label"] = "Toggle Pitch";
        this._btn.onclick = function () {
          if (map.getPitch() === 0) {
            let options = { pitch: _this._pitch, bearing: _this._bearing };
            if (_this._minpitchzoom && map.getZoom() > _this._minpitchzoom) {
              options.zoom = _this._minpitchzoom;
            }
            map.easeTo(options);
            _this._btn.className =
              "mapboxgl-ctrl-icon mapboxgl-ctrl-pitchtoggle-2d";
          } else {
            map.easeTo({ pitch: 0, bearing: 0 });
            _this._btn.className =
              "mapboxgl-ctrl-icon mapboxgl-ctrl-pitchtoggle-3d";
          }
        };
        this._container = document.createElement("div");
        this._container.className = "mapboxgl-ctrl-group mapboxgl-ctrl";
        this._container.appendChild(this._btn);
        return this._container;
      }
      onRemove() {
        this._container.parentNode.removeChild(this._container);
        this._map = undefined;
      }
    }
    map.addControl(new PitchToggle({ minpitchzoom: 11 }), "top-right");
    // afegim pop-ups que ens mostrin nom del lloc, la categoria i l'enllaç a la web amb més informació(de moment)
    map.on('click', function (e) {
      var features = map.queryRenderedFeatures(e.point, {
        layers: ['natura']
      });
      if (!features.length) {
        return;
      }
      var feature = features[0];
      var popup = new mapboxgl.Popup({ offset: [0, -15] })
        .setLngLat(feature.geometry.coordinates)
        .setHTML(
          '<div class="infowdw">' +
          '<h3>' + feature.properties.NOM + '</h3><p>'
          + '<strong>' + "Municipi:" + ' ' + '</strong>' + feature.properties.MUNICIPI
          + '</p><p>' + '<strong>' + "Categoria:" + ' ' + '</strong>' + feature.properties.CATEGORIA + '</p><p>'
          + '<img class="infoimg" src="goto.png"/><a class="link" target="_blank" href=' + feature.properties.URL + '> Més informació' + '</p>'
          + '</div>'
        )
        .addTo(map);
    });
 
    // Centrem i fem zoom a les coordenades del punt seleccionat.
    map.on('click', 'natura', function (e) {
      map.zoomTo(15.2, { center: e.features[0].geometry.coordinates });
    });
    // Canviem el cursor a un punter quan passem per sobre un seleccionable.
    map.on('mouseenter', 'natura', function () {
      map.getCanvas().style.cursor = 'pointer';
    });
    // Retorn a la mà al desseleccionar.
    map.on('mouseleave', 'natura', function () {
      map.getCanvas().style.cursor = '';
    });

  </script>
</body>

</html>